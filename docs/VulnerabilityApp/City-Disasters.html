<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="utils.js"></script>
    <script src="io.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <h1 style="text-align: center;">Relatório de Vulnerabilidade</h1>
    <h2>Selecione a cidade desejada</h2>

    <select id="fileDropdown"></select>
    <h2> </h2>
    <div class="section-header" onclick="toggleSection('disastersApp')">
        Ajuste de Desastres <span class="arrow down"></span>
    </div>
    <div class="section-content" id="disastersApp">
        <div id="chart" style="width:800px;height:550px;"></div>
        <div>
            <h3>Desastres Selecionados</h2>
                <div id="checkboxContainer"></div>

                <h3>Análise</h3>
                <input id="cityAnalysis" type="checkbox">
                <label>Cidade não pode ser analisada</label>
                <br>
                <input id="incorrectStation" type="checkbox" onchange="stationChanged(event)">
                <label>Estação incorreta</label><br>
                <input id='correctStation' type="text" placeholder="Estação correta" disabled="true" maxlength="8"
                    pattern="\d{8}" required>

                <h2></h2>
                <textarea id="observations" rows="5" placeholder="Observações"
                    style="padding: 10px; width: 300px;"></textarea>
                <br>
                <button onclick="IO.exportAnalysis(event)">Salvar Análise</button>
        </div>
    </div>

    <div id="content"></div>

</body>

</html>


<script>
    // First, load all the cities available on GitHub 
    IO.fetchCitiesFromGit().then(myFiles => {
        const fileDropdown = document.getElementById('fileDropdown')

        IO['cities'] = myFiles

        fetch("https://raw.githubusercontent.com/cordmaur/Fastai2-Medium/master/docs/DisastersApp/name_mapping.json")
            .then(response => response.json())
            .then(json => {
                IO['nameMapping'] = json

                myFiles.forEach(file => {
                    const option = document.createElement('option')
                    option.value = file.name
                    option.text = IO.nameMapping[file.name]
                    fileDropdown.appendChild(option)
                })

                // once the options from the dropdown are created, add the event listener
                fileDropdown.addEventListener('change', event => {
                    updateCity(event.target.value)
                })

                // load the first page
                updateCity(fileDropdown.value)
            })
    })


</script>