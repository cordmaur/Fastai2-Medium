// helper functions to fetch and load data 
IO = {
    rawUrl: 'https://raw.githubusercontent.com/cordmaur/Fastai2-Medium/master/docs/DisastersApp',
    apiUrl: 'https://api.github.com/repos/cordmaur/Fastai2-Medium/contents/docs/DisastersApp',
    fetchCitiesFromGit: async function () {
        // const apiUrl = 'https://api.github.com/repos/cordmaur/Fastai2-Medium/contents/docs/DisastersApp';

        try {
            const response = await fetch(IO.apiUrl);
            if (!response.ok) {
                throw new Error(`Network response was not ok: ${response.statusText}`);
            }
            const files = await response.json();

            // Filter for HTML files and create their URLs
            const htmlFiles = files
                .filter(file => file.type == 'dir')
            // .map(file => `${baseUrl}${file.name}`);

            // console.log(htmlFiles); // Output the list of HTML file URLs

            return htmlFiles;
        } catch (error) {
            console.error('Error fetching files from GitHub:', error);
        }
    },

    exportAnalysis: function (e) {
        console.log('exporting analysis')

        const data = getSelectedData()

        const fileDropdown = document.getElementById('fileDropdown')

        // Convert the data to be exported to a string
        // const csvString = arrayToCSV(data);
        // const blob = new Blob([csvString], { type: 'text/csv' });

        const jsonString = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonString], { type: 'text/plain' });

        // Create a link element
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileDropdown.value + '.json'
        document.body.appendChild(link);
        link.click();

        // Remove the link from the document
        document.body.removeChild(link);

    }
}
